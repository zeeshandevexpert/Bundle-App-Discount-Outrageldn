import{R as a,r as o,a as ye,b as ke,g as Pe,j as e,F as ve}from"./components-Dy2V4Mi5.js";import{c as H,v as ae,g as me,f as Q,s as he,T as w,h as pe,j as ge,k as fe,l as je,B as L,a as V,u as Ee,m as Be,P as Se,C as F,e as Z,I as J,b as W}from"./Page-BlUVaYsq.js";import{T as Ne}from"./TitleBar-CXzCZ9ZD.js";import{L as re,B as Ie,T as le}from"./Thumbnail-ZPSd0K-a.js";import"./context-Bogj3_SU.js";var be=function(r){return a.createElement("svg",Object.assign({viewBox:"0 0 20 20"},r),a.createElement("path",{fillRule:"evenodd",d:"M5 10c0-.414.336-.75.75-.75h8.5c.414 0 .75.336.75.75s-.336.75-.75.75h-8.5c-.414 0-.75-.336-.75-.75Z"}))};be.displayName="MinusIcon";var xe=function(r){return a.createElement("svg",Object.assign({viewBox:"0 0 20 20"},r),a.createElement("path",{d:"M12.72 13.78a.75.75 0 1 0 1.06-1.06l-2.72-2.72 2.72-2.72a.75.75 0 0 0-1.06-1.06l-2.72 2.72-2.72-2.72a.75.75 0 0 0-1.06 1.06l2.72 2.72-2.72 2.72a.75.75 0 1 0 1.06 1.06l2.72-2.72 2.72 2.72Z"}))};xe.displayName="XSmallIcon";const Te=o.createContext(!1);var D={Checkbox:"Polaris-Checkbox",ChoiceLabel:"Polaris-Checkbox__ChoiceLabel",Backdrop:"Polaris-Checkbox__Backdrop",Input:"Polaris-Checkbox__Input","Input-indeterminate":"Polaris-Checkbox__Input--indeterminate",Icon:"Polaris-Checkbox__Icon",animated:"Polaris-Checkbox--animated",toneMagic:"Polaris-Checkbox--toneMagic",hover:"Polaris-Checkbox--hover",error:"Polaris-Checkbox--error",checked:"Polaris-Checkbox--checked",pathAnimation:"Polaris-Checkbox--pathAnimation"},q={Choice:"Polaris-Choice",labelHidden:"Polaris-Choice--labelHidden",Label:"Polaris-Choice__Label",Control:"Polaris-Choice__Control",disabled:"Polaris-Choice--disabled",toneMagic:"Polaris-Choice--toneMagic",Descriptions:"Polaris-Choice__Descriptions",HelpText:"Polaris-Choice__HelpText"};function Ce({id:n,label:r,disabled:l,error:s,children:u,labelHidden:x,helpText:m,onClick:B,labelClassName:C,fill:S,bleed:d,bleedBlockStart:h,bleedBlockEnd:y,bleedInlineStart:j,bleedInlineEnd:E,tone:M}){const N=H(q.Choice,x&&q.labelHidden,l&&q.disabled,M&&q[ae("tone",M)],C),k={...Q("choice","bleed-block-end","space",y||d),...Q("choice","bleed-block-start","space",h||d),...Q("choice","bleed-inline-start","space",j||d),...Q("choice","bleed-inline-end","space",E||d),...Object.fromEntries(Object.entries(me("choice","fill",S)).map(([v,R])=>[v,R?"100%":"auto"]))},p=a.createElement("label",{className:N,htmlFor:n,onClick:B,style:he(k)},a.createElement("span",{className:q.Control},u),a.createElement("span",{className:q.Label},a.createElement(w,{as:"span",variant:"bodyMd"},r))),P=m?a.createElement("div",{className:q.HelpText,id:se(n)},a.createElement(w,{as:"span",tone:l?void 0:"subdued"},m)):null,i=s&&typeof s!="boolean"&&a.createElement("div",{className:q.Error},a.createElement(pe,{message:s,fieldID:n})),b=P||i?a.createElement("div",{className:q.Descriptions},i,P):null;return b?a.createElement("div",null,p,b):p}function se(n){return`${n}HelpText`}const ie=o.forwardRef(function({ariaControls:r,ariaDescribedBy:l,label:s,labelHidden:u,checked:x=!1,helpText:m,disabled:B,id:C,name:S,value:d,error:h,onChange:y,onFocus:j,onBlur:E,labelClassName:M,fill:N,bleed:k,bleedBlockStart:p,bleedBlockEnd:P,bleedInlineStart:i,bleedInlineEnd:b,tone:v},R){const T=o.useRef(null),O=o.useId(),_=C??O,$=o.useContext(Te);o.useImperativeHandle(R,()=>({focus:()=>{T.current&&T.current.focus()}}));const U=()=>{E&&E()},X=()=>{y==null||T.current==null||B||(y(T.current.checked,_),T.current.focus())},G=[];h&&typeof h!="boolean"&&G.push(fe(_)),m&&G.push(se(_)),l&&G.push(l);const Y=G.length?G.join(" "):void 0,ne=H(D.Checkbox,h&&D.error),z=x==="indeterminate",ee=!z&&!!x,te=z?{indeterminate:"true","aria-checked":"mixed"}:{"aria-checked":ee},t=a.createElement("svg",{viewBox:"0 0 16 16",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision"},a.createElement("path",{className:H(x&&D.checked),d:"M1.5,5.5L3.44655,8.22517C3.72862,8.62007,4.30578,8.64717,4.62362,8.28044L10.5,1.5",transform:"translate(2 2.980376)",opacity:"0",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",pathLength:"1"})),f=H(D.Input,z&&D["Input-indeterminate"],v&&D[ae("tone",v)]),c={helpText:m,error:h,bleed:k,bleedBlockStart:p,bleedBlockEnd:P,bleedInlineStart:i,bleedInlineEnd:b};return a.createElement(Ce,Object.assign({id:_,label:s,labelHidden:u,disabled:B,labelClassName:H(D.ChoiceLabel,M),fill:N,tone:v},c),a.createElement("span",{className:ne},a.createElement("input",Object.assign({ref:T,id:_,name:S,value:d,type:"checkbox",checked:ee,disabled:B,className:f,onBlur:U,onChange:_e,onClick:X,onFocus:j,"aria-invalid":h!=null,"aria-controls":r,"aria-describedby":Y,role:$?"presentation":"checkbox"},te)),a.createElement("span",{className:D.Backdrop,onClick:oe,onKeyUp:oe}),a.createElement("span",{className:H(D.Icon,!z&&D.animated)},z?a.createElement(ge,{source:be}):t)))});function _e(){}function oe(n){n.stopPropagation()}var Le={ChoiceChildren:"Polaris-ChoiceList__ChoiceChildren"},K={RadioButton:"Polaris-RadioButton",Input:"Polaris-RadioButton__Input",Backdrop:"Polaris-RadioButton__Backdrop",ChoiceLabel:"Polaris-RadioButton__ChoiceLabel",toneMagic:"Polaris-RadioButton--toneMagic"};function we({ariaDescribedBy:n,label:r,labelHidden:l,helpText:s,checked:u,disabled:x,onChange:m,onFocus:B,onBlur:C,id:S,name:d,value:h,fill:y,bleed:j,bleedBlockStart:E,bleedBlockEnd:M,bleedInlineStart:N,bleedInlineEnd:k,tone:p}){const P=o.useId(),i=S??P,b=d||i,v=o.useRef(null),R=()=>{C&&C()};function T({currentTarget:X}){m&&m(X.checked,i)}const O=[];s&&O.push(se(i)),n&&O.push(n);const _=O.length?O.join(" "):void 0,$=H(K.Input,p&&K[ae("tone",p)]),U={helpText:s,bleed:j,bleedBlockStart:E,bleedBlockEnd:M,bleedInlineStart:N,bleedInlineEnd:k};return a.createElement(Ce,Object.assign({label:r,labelHidden:l,disabled:x,id:i,labelClassName:K.ChoiceLabel,fill:y},U,u?{tone:p}:{}),a.createElement("span",{className:K.RadioButton},a.createElement("input",{id:i,name:b,value:h,type:"radio",checked:u,disabled:x,className:$,onChange:T,onFocus:B,onBlur:R,"aria-describedby":_,ref:v}),a.createElement("span",{className:K.Backdrop})))}function Me({title:n,titleHidden:r,allowMultiple:l,choices:s,selected:u,onChange:x=Re,error:m,disabled:B=!1,name:C,tone:S}){const d=l?ie:we,h=o.useId(),y=C??h,j=l?`${y}[]`:y,E=n?a.createElement(V,{as:"legend",paddingBlockEnd:{xs:"0",md:"100"}},a.createElement(w,{as:"span",variant:"bodyMd",visuallyHidden:r},n)):null,M=s.map(k=>{const{value:p,id:P,label:i,helpText:b,disabled:v,describedByError:R}=k;function T(U){x(Oe(k,U,u,l),y)}const O=ce(k,u),_=k.renderChildren?k.renderChildren(O):null,$=_?a.createElement("div",{className:Le.ChoiceChildren},a.createElement(V,{paddingBlockStart:{xs:"400",md:"0"}},_)):null;return a.createElement("li",{key:p},a.createElement(je,{marginBlockEnd:b?{xs:"100",md:"0"}:{xs:"0"}},a.createElement(d,{name:j,value:p,id:P,label:i,disabled:v||B,fill:{xs:!0,sm:!1},checked:ce(k,u),helpText:b,onChange:T,ariaDescribedBy:m&&R?fe(j):null,tone:S}),$))}),N=m&&a.createElement(V,{paddingBlockStart:{xs:"0",md:"100"},paddingBlockEnd:"200"},a.createElement(pe,{message:m,fieldID:j}));return a.createElement(L,{as:"fieldset",gap:{xs:"400",md:"0"},"aria-invalid":m!=null,id:j},E,a.createElement(L,{as:"ul",gap:{xs:"400",md:"0"}},M),N)}function Re(){}function ce({value:n},r){return r.includes(n)}function Oe({value:n},r,l,s=!1){return r?s?[...l,n]:[n]:l.filter(u=>u!==n)}var Ae={InlineGrid:"Polaris-InlineGrid"};function De({children:n,columns:r,gap:l,alignItems:s}){const u={...me("inline-grid","grid-template-columns",He(r)),...Q("inline-grid","gap","space",l),"--pc-inline-grid-align-items":s};return a.createElement("div",{className:Ae.InlineGrid,style:he(u)},n)}function He(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.fromEntries(Object.entries(n).map(([r,l])=>[r,de(l)])):de(n)}function de(n){if(n)return typeof n=="number"||!isNaN(Number(n))?`repeat(${Number(n)}, minmax(0, 1fr))`:typeof n=="string"?n:n.map(r=>{switch(r){case"oneThird":return"minmax(0, 1fr)";case"oneHalf":return"minmax(0, 1fr)";case"twoThirds":return"minmax(0, 2fr)"}}).join(" ")}var I={Tag:"Polaris-Tag",disabled:"Polaris-Tag--disabled",clickable:"Polaris-Tag--clickable",linkable:"Polaris-Tag--linkable",removable:"Polaris-Tag--removable",Button:"Polaris-Tag__Button",Link:"Polaris-Tag__Link",segmented:"Polaris-Tag--segmented",Text:"Polaris-Tag__Text",sizeLarge:"Polaris-Tag--sizeLarge",overlay:"Polaris-Tag--overlay"};function ue({children:n,disabled:r=!1,onClick:l,onRemove:s,accessibilityLabel:u,url:x,size:m}){const B=Ee(),C=s&&x,S=H(I.Tag,r&&I.disabled,l&&I.clickable,s&&I.removable,x&&!r&&I.linkable,C&&I.segmented,m&&I[ae("size",m)]);let d=u;d||(d=typeof n=="string"?n:void 0);const h=a.createElement(w,{as:"span",variant:"bodySm",truncate:!0},a.createElement("span",{title:d,className:I.Text},n));if(l)return a.createElement("button",{type:"button",disabled:r,className:S,onClick:l},h);const y=B.translate("Polaris.Tag.ariaLabel",{children:d||""}),j=s?a.createElement("button",{type:"button","aria-label":y,className:H(I.Button,C&&I.segmented),onClick:s,onMouseUp:Be,disabled:r},a.createElement(ge,{source:xe})):null,E=x&&!r?a.createElement("a",{className:H(I.Link,C&&I.segmented),href:x},h):h;return a.createElement("span",{className:S,"aria-disabled":r},E,m==="large"&&a.createElement("span",{className:I.overlay}),j)}function ze(){var te;const n=ye(),l=ke().state==="submitting",s=Pe(),[u,x]=o.useState(""),[m,B]=o.useState("specificProducts"),[C,S]=o.useState("Limited Offer"),[d,h]=o.useState(""),[y,j]=o.useState(!0),[E,M]=o.useState(!1),[N,k]=o.useState("10"),[p,P]=o.useState([]),[i,b]=o.useState({}),[v,R]=o.useState([]),T=async()=>{const t=await shopify.resourcePicker({type:"product",action:"select",multiple:!0});if(t){const f=t.map(c=>{var g;return{title:c.title,id:c.id,variants:c.variants.map(A=>({id:A.id,title:A.title,quantity:1,price:parseFloat(A.price),originalPrice:parseFloat(A.price)})),quantity:1,featuredImage:((g=c.images[0])==null?void 0:g.originalSrc)||"",offer:0}});R(f)}};o.useEffect(()=>{s!=null&&s.success?(shopify.toast.show("Yay!, Product Bundle Saved"),x(""),S("Limited Offer"),h(""),k("10"),P([]),R([]),b({})):s!=null&&s.errors&&b(s.errors)},[s]);const O=o.useCallback(t=>{x(t),i.bundleName&&b({...i,bundleName:void 0})},[i]),_=o.useCallback(t=>B(t),[]),$=o.useCallback(t=>{S(t),i.displayText&&b({...i,displayText:void 0})},[i]),U=o.useCallback(t=>j(t),[]),X=o.useCallback(t=>M(t),[]),G=()=>{const t={};return u.trim()||(t.bundleName="Bundle name is required"),C.trim()||(t.displayText="Display text is required"),/^\d+(\.\d+)?$/.test(N)||(t.offer="Offer must be a valid number"),p.length===0&&(t.selectedProducts="At least one product must be selected"),v.length===0&&(t.assignedProducts="Assign at least one product to show the bundle."),Object.keys(t).length>0?t:null},Y=o.useCallback(()=>{const t=G();if(t){b(t);return}const f={bundleName:u,displayText:C,offer:N,showComparisonPrice:y.toString(),directToCheckout:E.toString(),selectedProducts:JSON.stringify(p),assignedProducts:JSON.stringify(v.map(c=>c.id)),bundleImage:d};n(f,{method:"post"})},[u,C,N,y,E,d,n,p,v]),ne=async()=>{try{const t=await shopify.resourcePicker({type:"product",action:"select",multiple:!1});if(t&&t.length>0){const f=t[0];f.images&&f.images.length>0?(f.images.length,h(f.images[0].originalSrc),i.bundleImage&&b({...i,bundleImage:void 0})):shopify.toast.show("Selected product has no images. Please choose a different product.",{isError:!0})}}catch(t){console.error("Error selecting image:",t),shopify.toast.show("Unable to open image picker. Please enter image URL manually.",{isError:!0})}},z=async()=>{const t=await shopify.resourcePicker({type:"collection",action:"select",multiple:!0});console.log(t)},ee=async()=>{const t=await shopify.resourcePicker({type:"product",action:"select",multiple:!0,filter:{query:"(gift_card:false) AND (inventory_total:>1)",variants:!0}});if(t){const f=t.map(c=>({title:c.title,id:c.id,variants:c.variants.map(g=>({id:g.id,title:g.title,quantity:1,price:parseFloat(g.price),originalPrice:parseFloat(g.price)})),quantity:1,featuredImage:c.images[0].originalSrc,offer:parseFloat(N)}));P(f),i.selectedProducts&&b({...i,selectedProducts:void 0})}else P([])};return e.jsxs(Se,{title:"New Bundle",primaryAction:{content:"Create bundle",onAction:Y,disabled:l,loading:l},children:[e.jsx(Ne,{title:"Bundler App"}),e.jsx(L,{gap:"500",children:e.jsx(re,{children:e.jsxs(re.Section,{children:[((te=s==null?void 0:s.errors)==null?void 0:te.message)&&e.jsx(Ie,{tone:"critical",children:e.jsx("p",{children:s.errors.message})}),e.jsx(ve,{method:"post",children:e.jsxs(L,{gap:"400",children:[e.jsx(F,{children:e.jsx(Z,{label:"Bundle Name (Internal)",value:u,onChange:O,autoComplete:"off",placeholder:"Bundle Name",name:"bundleName",error:i.bundleName})}),e.jsx(F,{children:e.jsx(Z,{label:"Display Text",value:C,onChange:$,autoComplete:"off",name:"displayText",error:i.displayText})}),e.jsx(F,{children:e.jsxs(L,{gap:"300",children:[e.jsx(w,{variant:"headingMd",as:"h3",children:"Bundle Image"}),e.jsx(Z,{label:"Image URL",value:d,onChange:t=>{h(t),i.bundleImage&&b({...i,bundleImage:void 0})},autoComplete:"off",name:"bundleImage",placeholder:"Enter image URL or select from products below",error:i.bundleImage}),e.jsxs(J,{gap:"200",align:"space-between",children:[e.jsx(W,{onClick:ne,variant:"secondary",children:"Pick Image from Products"}),d&&e.jsx(W,{onClick:()=>h(""),variant:"tertiary",tone:"critical",children:"Remove Image"})]}),d&&e.jsx(V,{paddingBlockStart:"200",children:e.jsx(le,{source:d,alt:"Bundle preview",size:"large"})})]})}),e.jsx(F,{children:e.jsx(Z,{label:"Bundle Offer",type:"number",prefix:"%",autoComplete:"off",value:N,name:"offer",onChange:t=>{k(t),i.offer&&b({...i,offer:void 0})},error:i.offer})}),e.jsx(F,{children:e.jsxs(L,{gap:"200",children:[e.jsx(w,{variant:"bodyMd",as:"p",children:"Product or Collection Selection:"}),e.jsx(Me,{title:"",titleHidden:!0,name:"productSelection",choices:[{label:"Specific Products",value:"specificProducts"},{label:"Specific Collections",value:"specificCollections"}],selected:[m],onChange:t=>_(t[0])}),e.jsxs(J,{children:[m==="specificProducts"&&e.jsx(W,{onClick:ee,variant:"primary",children:"Select A Product"}),m==="specificCollections"&&e.jsx(W,{variant:"primary",disabled:!0,onClick:z,children:"Select A Collection"})]}),i.selectedProducts&&e.jsx(w,{as:"h3",tone:"critical",children:i.selectedProducts})]})}),p.length>0&&e.jsx(F,{children:e.jsxs(L,{gap:"600",children:[e.jsx(w,{as:"h3",variant:"headingMd",children:"Selected Products"}),p.map((t,f)=>e.jsx(V,{borderColor:"border-brand",borderWidth:"025",padding:"300",borderRadius:"050",children:e.jsxs(De,{columns:2,gap:"600",children:[e.jsxs(L,{gap:"500",children:[e.jsxs(J,{gap:"600",blockAlign:"center",children:[e.jsx(le,{source:t.featuredImage,alt:t.title,size:"small"}),e.jsx(L,{gap:"200",children:e.jsx(w,{as:"h3",variant:"headingMd",children:t.title})})]}),e.jsxs(L,{gap:"200",children:[e.jsx(w,{as:"p",variant:"bodyMd",alignment:"start",children:"Variants:"}),e.jsx(J,{gap:"200",children:t.variants.map(c=>e.jsx(ue,{onRemove:()=>{let g=[...p];g[f].variants=g[f].variants.filter(A=>A.id!==c.id),g[f].variants.length===0&&(g=g.filter(A=>A.id!==t.id)),P(g)},children:c.title},c.id))})]})]}),e.jsxs(J,{gap:"200",blockAlign:"center",align:"end",children:[e.jsx("div",{style:{width:"80px"},children:e.jsx(Z,{type:"number",value:t.quantity.toString(),autoComplete:"off",labelHidden:!0,label:"Quantity",onChange:c=>{let g=[...p];g[f].quantity=parseInt(c),g[f].variants=g[f].variants.map(A=>({...A,quantity:parseInt(c)})),P(g)}})}),e.jsx(V,{width:"max-content",children:e.jsx(W,{variant:"secondary",tone:"critical",onClick:()=>{let c=[...p];c=c.filter(g=>g.id!==t.id),P(c)},children:"Remove"})})]})]})},t.id))]})}),e.jsx(F,{children:e.jsxs(L,{gap:"200",children:[e.jsx(W,{onClick:T,variant:"primary",children:"Assign Bundle To Product(s)"}),i.assignedProducts&&e.jsx(w,{as:"h3",tone:"critical",children:i.assignedProducts}),e.jsx(J,{gap:"200",children:v.map(t=>e.jsx(ue,{children:t.title},t.id))})]})}),e.jsxs(F,{children:[e.jsx(L,{gap:"200"}),e.jsx(ie,{label:"Show Comparison Prices",checked:y,onChange:U,name:"showComparisonPrice",helpText:"Show comparison price in the product page"}),e.jsx(ie,{label:"Direct to Checkout",checked:E,onChange:X,name:"directToCheckout",helpText:"Customer will be redirected directly to checkout"})]}),e.jsx(V,{children:e.jsx(J,{gap:"300",align:"end",children:e.jsx(W,{variant:"primary",onClick:Y,disabled:l,loading:l,children:"Publish"})})}),e.jsx("input",{type:"hidden",name:"selectedProducts",value:JSON.stringify(p)}),e.jsx("input",{type:"hidden",name:"assignedProducts",value:JSON.stringify(v.map(t=>t.id))}),e.jsx("input",{type:"hidden",name:"bundleImage",value:d})]})})]})})})]})}export{ze as default};
